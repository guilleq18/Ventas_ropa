{# templates/caja/_pagos_body.html #}
{% load caja_extras %}

{% if total_base <= 0 %}
  <p class="grey-text">Agregá productos al carrito.</p>
{% else %}

  <div style="margin-top:10px;">
    {% if not payments %}
      <p class="grey-text">No hay formas de pago cargadas.</p>
    {% else %}
      <table class="striped" style="font-size:13px;">
        <thead>
          <tr>
            <th>Tipo</th>
            <th>Detalle</th>
            <th class="right-align">Importe</th>
            <th class="right-align">Recargo</th>
            <th class="right-align">Total</th>
            <th class="right-align"></th>
          </tr>
        </thead>
        <tbody>
          {% for p in payments %}
            <tr>
              <td style="font-weight:700;">
                {{ p.get_tipo_display|default:p.tipo }}
              </td>

              <td class="grey-text text-darken-1" style="max-width:420px;">
                {% if p.tipo == "CREDITO" %}
                  {% if p.plan and p.plan.tarjeta %}
                    {{ p.plan.tarjeta }} ·
                  {% elif p.tarjeta %}
                    {{ p.tarjeta }} ·
                  {% endif %}
                  {{ p.cuotas }} cuotas
                  {% if p.recargo_pct|add:0 > 0 %}
                    · Recargo {{ p.recargo_pct|num_ar }}%
                  {% endif %}
                {% endif %}

                {% if p.tipo == "TRANSFERENCIA" or p.tipo == "QR" %}
                  {% if p.referencia %}
                    Ref: {{ p.referencia }}
                  {% endif %}
                {% endif %}
              </td>

              <td class="right-align mono">
                ${{ p.monto|num_ar }}
              </td>

              <td class="right-align mono">
                {% if p.tipo == "CREDITO" %}
                  {% if p.recargo_monto_calc %}
                    ${{ p.recargo_monto_calc|num_ar }}
                  {% else %}
                    ${{ p.recargo_monto|num_ar }}
                  {% endif %}
                {% else %}
                  $0,00
                {% endif %}
              </td>

              <td class="right-align mono" style="font-weight:900;">
                {% if p.tipo == "CREDITO" %}
                  {% if p.total_tarjeta_calc %}
                    ${{ p.total_tarjeta_calc|num_ar }}
                  {% else %}
                    ${{ p.monto|add:p.recargo_monto|num_ar }}
                  {% endif %}
                {% else %}
                  ${{ p.monto|num_ar }}
                {% endif %}
              </td>

              <td class="right-align">
                <form hx-post="{% url 'caja:pagos_del' forloop.counter0 %}"
                      hx-target="#pagos_body"
                      hx-swap="innerHTML"
                      style="margin:0;">
                  {% csrf_token %}
                  <button class="btn-flat red-text" type="submit">Quitar</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
  </div>

{% endif %}

{% if not suppress_oob %}
  <div hx-swap-oob="innerHTML:#pagos_totales" style="display:none">
    {% include "caja/_pagos_totales.html" %}
  </div>

  <div hx-swap-oob="innerHTML:#total_cobrar_card" style="display:none">{{ total_cobrar|num_ar }}</div>
  <div hx-swap-oob="innerHTML:#total_cobrar_confirm" style="display:none">{{ total_cobrar|num_ar }}</div>
{% endif %}
