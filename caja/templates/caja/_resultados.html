{# caja/_resultados.html #}
{% load caja_extras %}


{% if not results %}
  <div class="grey-text" style="padding:6px 2px;">Escribí para buscar…</div>
{% else %}
  <ul class="collection">
    {% for v in results %}
      <li class="collection-item">
        <div style="display:flex; justify-content:space-between; gap:10px; align-items:flex-start;">
          <div>
            <div style="font-weight:600;">{{ v.sku }} — {{ v.producto.nombre }}</div>
            <div style="margin-top:6px;">
              {% with stock=stock_map|get_item:v.id %}
                {% if stock|default:0|add:0 > 0 %}
                  <span class="new badge green lighten-4 green-text text-darken-2" data-badge-caption="Stock: {{ stock }}"></span>
                {% else %}
                  <span class="new badge red lighten-4 red-text text-darken-2" data-badge-caption="Sin stock"></span>
                {% endif %}
              {% endwith %}
              <span class="grey-text" style="margin-left:8px;">{{ sucursal.nombre }}</span>
            </div>
          </div>

          <div style="text-align:right; min-width:120px;">
            <div style="font-weight:700;">${{ v.precio }}</div>

            <form hx-post="{% url 'caja:carrito_agregar' v.id %}"
                  hx-target="#carrito_body"
                  hx-swap="innerHTML"
                  style="margin-top:8px;">
              {% csrf_token %}
              {% with stock=stock_map|get_item:v.id %}
                <button class="btn-small {% if stock|default:0|add:0 > 0 %}blue{% else %}grey{% endif %}"
                        {% if stock|default:0|add:0 <= 0 %}disabled{% endif %}>
                  Agregar
                </button>
              {% endwith %}
            </form>
          </div>
        </div>
      </li>
    {% endfor %}
  </ul>
{% endif %}
