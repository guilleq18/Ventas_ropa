{# templates/caja/_pagos_table.html #}
{% load caja_extras %}

{% if not payments %}
  <p class="grey-text" style="margin:0;">No hay formas de pago cargadas.</p>
{% else %}
  <table class="highlight responsive-table" style="font-size:13px;">
    <thead>
      <tr>
        <th style="width:24%;">Tipo</th>
        <th style="width:30%;">Detalle</th>
        <th class="right-align" style="width:14%;">Monto</th>
        <th class="right-align" style="width:14%;">Recargo</th>
        <th class="right-align" style="width:14%;">Total</th>
        <th style="width:1%;"></th>
      </tr>
    </thead>
    <tbody>
      {% for p in payments %}
        <tr>
          <td style="padding-top:10px; padding-bottom:10px;">
            <div style="font-weight:600; line-height:1.2;">{{ p.get_tipo_display|default:p.tipo }}</div>
            {% if p.tipo == "CREDITO" and p.tarjeta %}
              <div class="grey-text" style="font-size:11px; line-height:1.2; margin-top:2px;">
                {{ p.tarjeta }}
              </div>
            {% endif %}
          </td>

          <td class="grey-text text-darken-2" style="padding-top:10px; padding-bottom:10px;">
            <div style="line-height:1.25;">
              {% if p.tipo == "CREDITO" %}
                {{ p.cuotas }} cuotas
                {% if p.recargo_pct|add:0 > 0 %} · {{ p.recargo_pct|num_ar }}%{% endif %}
              {% else %}
                {% if p.referencia %}Ref: {{ p.referencia }}{% else %}—{% endif %}
              {% endif %}
            </div>
          </td>

          <td class="right-align" style="padding-top:10px; padding-bottom:10px; white-space:nowrap;">
            ${{ p.monto|num_ar }}
          </td>

          <td class="right-align" style="padding-top:10px; padding-bottom:10px; white-space:nowrap;">
            {% if p.tipo == "CREDITO" %}
              +${{ p.recargo_monto_calc|num_ar }}
            {% else %}
              $0,00
            {% endif %}
          </td>

          <td class="right-align" style="padding-top:10px; padding-bottom:10px; white-space:nowrap;">
            {% if p.tipo == "CREDITO" %}
              <strong>${{ p.total_tarjeta_calc|num_ar }}</strong>
            {% else %}
              <strong>${{ p.monto|num_ar }}</strong>
            {% endif %}
          </td>

          <td class="right-align" style="padding-top:10px; padding-bottom:10px;">
            <form hx-post="{% url 'caja:pagos_del_table' forloop.counter0 %}"
                  hx-swap="none"
                  style="margin:0;">
              {% csrf_token %}
              <button class="btn-small red" type="submit" style="height:32px; line-height:32px;" title="Quitar" aria-label="Quitar">
                <i class="material-icons" style="font-size:18px; line-height:32px;">delete</i>
              </button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}
